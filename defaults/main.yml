---
# defaults for consul
consul_domain: consul
# the group in the inventory file, that groups all consul agents that run in server mode
consul_servers_group: consulservers

# defaults file for consul
consul_dc: dc1
consul_advertise: "{{ansible_default_ipv4.address}}"
consul_bind_addr: "{{ ansible_default_ipv4.address }}"
#consul_retry_join: "{% for host in groups[consul_servers_group] %}\"{{ hostvars[host].ansible_default_ipv4.address }}\"{% if not loop.last %}, {% endif %}{% endfor %}"
consul_client_addr: 0.0.0.0
consul_leave_on_terminate: "true"
consul_rejoin_after_levae: "true"
consul_datacenter: "dc1"
consul_acl_datacenter: "dc1"

consul_servers_list: "
        {%- if consul_servers is defined -%}
           {{ consul_servers }}
	{%- else -%}
	    {{ groups[consul_servers_group] }}
        {%- endif -%}"

consul_join_ip: "
        {%- if consul_servers is defined -%}
            {{ consul_servers[0] }}
        {%- else -%}
            {{ hostvars[groups[consul_servers_group][0]]['ansible_default_ipv4']['address'] }}
        {%- endif -%}"
consul_bootstrap_expect: "{{ consul_servers_list | length }}"
# if the default ipv4 address is the consul_join_ip (first in consulservers list), this server is started in bootstrap mode
# otherwise not
consul_bootstrap: "{% if ansible_default_ipv4.address == consul_join_ip %}1{% else %}0{% endif %}"

# defining consul version and image to use
consul_version: '0.7.0'
consul_image: "consul"
consul_image_and_tag: "consul:{{consul_version}}"
docker_bridge_ip: "{{ansible_default_ipv4.address}}"
